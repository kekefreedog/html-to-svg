{"version":3,"file":"html-to-svg.js","sources":["../src/utils/dom-walk.js","../src/utils/dom-render-svg.js","../src/renderers/canvas.js","../src/renderers/div.js","../src/renderers/svg.js","../src/renderers/text.js","../src/renderers/image.js","../src/index.js","../src/utils/range-get-client-rects.js"],"sourcesContent":["async function walk (element, callback) {\n  if (!await callback(element)) return\n\n  for (const child of element.children) {\n    await walk(child, callback)\n  }\n}\n\nexport default walk\n","export default function (name, props = {}, parent) {\n  const NS = 'http://www.w3.org/2000/svg'\n\n  const element = document.createElementNS(NS, name)\n  if (name === 'svg') element.setAttributeNS('http://www.w3.org/2000/xmlns/', 'xmlns', NS)\n  for (const key in props) {\n    if (props[key] === null || props[key] === undefined) continue\n    element.setAttribute(key, props[key])\n  }\n\n  if (parent) parent.appendChild(element)\n  return element\n}\n","import $ from '../utils/dom-render-svg'\n\nexport default ({\n  debug,\n  fonts\n}) => async (element, { x, y, width, height, style }) => $('image', {\n  x,\n  y,\n  width,\n  height,\n  href: element.toDataURL('image/png')\n})\n","import $ from '../utils/dom-render-svg'\n\nexport default ({\n  debug,\n  fonts\n}) => async (element, { x, y, width, height, style }) => {\n  if (!width || !height) return\n\n  // TODO background-image\n  // TODO border\n  const backgroundColor = style.getPropertyValue('background-color')\n\n  // Skip visually empty blocks\n  if (!backgroundColor || backgroundColor === 'none' || backgroundColor === 'transparent') return\n  if (backgroundColor.startsWith('rgba')) {\n    const rgba = backgroundColor.match(/[\\d.]+/g)\n    if (rgba[3] === '0') return\n  }\n\n  return $('rect', {\n    x,\n    y,\n    width,\n    height,\n    fill: backgroundColor,\n    rx: parseInt(style.getPropertyValue('border-radius')) || null\n  })\n}\n","/* global XMLSerializer, btoa */\nimport $ from '../utils/dom-render-svg'\n\nexport default ({\n  debug,\n  fonts\n}) => async (element, { x, y, width, height, style }) => $('image', {\n  x,\n  y,\n  width,\n  height,\n  href: 'data:image/svg+xml;base64,' + btoa(new XMLSerializer().serializeToString(element))\n})\n","// TODO text-decoration\n\nimport $ from '../utils/dom-render-svg'\n\nconst matchFont = s => ({ family, style = 'normal', weight = '400' } = {}) =>\n  family === (s.getPropertyValue('font-family') ?? '').replace(/['\"]/g, '') &&\n    style === (s.getPropertyValue('font-style') ?? 'normal') &&\n    weight === (s.getPropertyValue('font-weight') ?? '400')\n\nexport default ({\n  debug,\n  fonts\n}) => async (string, { x, y, width, height, style }) => {\n  if (!string) return\n\n  const g = $('g')\n\n  // Find font\n  const font = fonts.find(matchFont(style))\n  if (!font) throw new Error(`Cannot find font '${style.getPropertyValue('font-family')} ${style.getPropertyValue('font-style')} ${style.getPropertyValue('font-weight')}'`)\n\n  // Extract font metrics\n  const { unitsPerEm } = font.opentype\n  const ascender = font.opentype.tables.hhea.ascender\n  const descender = font.opentype.tables.hhea.descender\n\n  // Extract CSS props\n  const letterSpacing = style.getPropertyValue('letter-spacing')\n  const fontSize = parseFloat(style.getPropertyValue('font-size'))\n\n  // Compute metrics\n  const lineBox = (ascender - descender) / unitsPerEm\n  const leading = (fontSize * lineBox) - Math.abs(descender / unitsPerEm) * fontSize\n\n  // Render various metrics for debug\n  line('start', 0, { orientation: 'vertical', stroke: 'red' })\n  line('end', width, { orientation: 'vertical', stroke: 'red' })\n  line('leading', leading, { stroke: '#4b96ff' })\n\n  if (letterSpacing !== 'normal') {\n    // Render letter by letter in case of non-default letter-spacing\n    for (const c of string) {\n      $('path', {\n        d: font.opentype.getPath(c, x, y + leading, fontSize).toPathData(3),\n        fill: style.getPropertyValue('color')\n      }, g)\n      x += font.opentype.getAdvanceWidth(c, fontSize) + parseFloat(letterSpacing)\n    }\n  } else {\n    // Render string\n    $('path', {\n      d: font.opentype.getPath(string, x, y + leading, fontSize, {\n        features: {\n          // TODO extract from CSS props\n          liga: true,\n          rlig: true\n        }\n      }).toPathData(3),\n      fill: style.getPropertyValue('color')\n    }, g)\n  }\n\n  return g\n\n  function line (title, v, { orientation = 'horizontal', stroke = 'black' } = {}) {\n    return debug && $('line', {\n      title,\n      'data-value': v,\n      x1: orientation === 'horizontal' ? x : x + v,\n      x2: orientation === 'horizontal' ? x + width : x + v,\n      y1: orientation === 'horizontal' ? y + v : y,\n      y2: orientation === 'horizontal' ? y + v : y + height,\n      stroke,\n      class: 'debug'\n    }, g)\n  }\n}\n","import $ from '../utils/dom-render-svg'\n\nexport default ({\n  debug,\n  fonts\n}) => async (element, { x, y, width, height, style }) => {\n  if (!width || !height) return\n  if (!element.src) return\n\n  return $('image', {\n    x,\n    y,\n    width,\n    height,\n    href: element.src\n  })\n}\n","/* global Node */\nimport Opentype from 'opentype.js'\nimport walk from './utils/dom-walk'\nimport getClientRects from './utils/range-get-client-rects'\n\nimport $ from './utils/dom-render-svg'\nimport * as RENDERERS from './renderers'\n\nexport default function (container = document.body, {\n  debug = false,\n  ignore = '',\n  fonts = []\n} = {}) {\n  // Init curried renderers\n  const renderers = {}\n  for (const k in RENDERERS) {\n    renderers[k] = RENDERERS[k]({ debug, fonts })\n  }\n\n  return {\n    // Preload all fonts before resolving\n    preload: async function () {\n      for (const font of fonts) {\n        if (font.opentype) continue\n        font.opentype = await new Promise(resolve => {\n          Opentype.load(font.url, (error, font) => {\n            if (error) throw error\n            resolve(font)\n          })\n        })\n      }\n    },\n\n    // Clear cache and delete all resources\n    flush: function () {\n      for (const font of fonts) delete font.opentype\n    },\n\n    // Render the HTML container as a shadow SVG\n    compute: async function () {\n      const viewBox = container.getBoundingClientRect()\n\n      // Create the SVG container\n      const svg = $('svg', {\n        viewBox: `0 0 ${viewBox.width} ${viewBox.height}`,\n        width: viewBox.width,\n        height: viewBox.height,\n        preserveAspectRatio: 'none'\n      })\n\n      // Set the parent to the current SVG.\n      // This parent will change during the walk\n      let parent = svg\n\n      // Render every children\n      await walk(container, async element => {\n        if (ignore && element !== container && element.matches(ignore)) return\n\n        // TODO opacity\n        const style = window.getComputedStyle(element)\n        const { x, y, width, height } = element.getBoundingClientRect()\n\n        // Handle CSS clip-path property\n        const clipPathValue = style.getPropertyValue('clip-path')\n        if (clipPathValue !== 'none') {\n          parent = $('g', null, svg)\n          // WARNING: CSS clip-path implementation is not done yet on arnaudjuracek/svg-to-pdf\n          parent.setAttribute('style', `clip-path: ${clipPathValue}`)\n        }\n\n        // Render element\n        const render = renderers[element.tagName] ?? renderers.div\n        const rendered = await render(element, {\n          x: x - viewBox.x,\n          y: y - viewBox.y,\n          width,\n          height,\n          style\n        })\n\n        if (rendered) parent.appendChild(rendered)\n\n        // Render text nodes inside the element\n        if (element.innerText) {\n          for (const node of element.childNodes) {\n            if (node.nodeType !== Node.TEXT_NODE) continue\n            if (!node.textContent.length) continue\n\n            // Text interface does not provide a .innerText method, which would be\n            // more appropriate than textContent as it skips non-rendered whitespaces\n            // Splitting white-space leading Text trick the browser to recompute\n            // the layout itself, dealing with implicit space between adjacent nodes\n            if (/^\\s/.test(node.textContent)) {\n              node.splitText(1)\n              continue\n            }\n\n            for (const { rect, fragment } of getClientRects(node)) {\n              try {\n                const text = await renderers.text(fragment.textContent.trimEnd(), {\n                  x: rect.x - viewBox.x,\n                  y: rect.y - viewBox.y,\n                  width: rect.width,\n                  height: rect.height,\n                  style\n                })\n                if (text) parent.appendChild(text)\n              } catch (error) {\n                // TODO[improve] error handling\n                console.warn(new Error(`Rendering failed for the following text: '${fragment.textContent}'`, { cause: error }))\n                console.warn(error)\n              }\n            }\n          }\n        }\n\n        // Continue walking\n        return true\n      })\n\n      return svg\n    }\n  }\n}\n","/* global DocumentFragment */\n\n// Return Range.clientRects with their corresponding DocumentFragment\nexport default function (node, text = node.innerText || node.textContent) {\n  const range = document.createRange()\n\n  const rects = []\n  for (let i = 0; i < node.length; i++) {\n    range.setStart(node, 0)\n    range.setEnd(node, (i + 1))\n\n    const clientRects = range.getClientRects()\n\n    const index = clientRects.length - 1\n    rects[index] = rects[index] ?? { text: '' }\n    rects[index].rect = clientRects[index]\n    rects[index].text += text.charAt(i)\n  }\n\n  return rects.map(rect => {\n    rect.fragment = new DocumentFragment()\n    rect.fragment.textContent = rect.text\n    return rect\n  })\n}\n"],"names":["_iteratorSymbol","Symbol","iterator","_settle","pact","state","value","s","_Pact","o","bind","v","then","observer","prototype","onFulfilled","onRejected","result","this","callback","e","_this","_isSettledPact","thenable","walk","element","Promise","resolve","_callback","_temp","target","body","check","step","reject","_cycle","next","done","return","_fixup","TypeError","values","i","length","push","array","_forTo","_forOf","children","child","$","name","props","parent","NS","document","createElementNS","key","setAttributeNS","setAttribute","appendChild","div","_ref","_ref2","x","y","width","height","style","backgroundColor","getPropertyValue","startsWith","match","fill","rx","parseInt","href","btoa","XMLSerializer","serializeToString","debug","fonts","string","_ref3","line","title","_temp2","_ref4","_ref4$orientation","orientation","_ref4$stroke","stroke","x1","x2","y1","y2","class","g","font","find","_s$getPropertyValue","_s$getPropertyValue2","_s$getPropertyValue3","_ref$style","_ref$weight","weight","family","replace","Error","unitsPerEm","opentype","ascender","tables","hhea","descender","letterSpacing","fontSize","parseFloat","leading","Math","abs","_step","_iterator","_createForOfIteratorHelperLoose","c","d","getPath","toPathData","getAdvanceWidth","features","liga","rlig","toDataURL","src","container","_ref$debug","_ref$ignore","ignore","_ref$fonts","renderers","k","RENDERERS","preload","Opentype","load","url","error","_Promise","flush","compute","viewBox","getBoundingClientRect","svg","preserveAspectRatio","_renderers$element$ta","matches","window","getComputedStyle","_element$getBoundingC","clipPathValue","render","tagName","rendered","_temp4","innerText","childNodes","node","nodeType","Node","TEXT_NODE","textContent","test","text","range","createRange","rects","_rects$index","setStart","setEnd","clientRects","getClientRects","index","rect","charAt","map","fragment","DocumentFragment","_temp3","recover","trimEnd","_catch","console","warn","cause","splitText"],"mappings":"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"}