import t from"opentype.js";function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function r(t,r){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,r){if(t){if("string"==typeof t)return e(t,r);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?e(t,r):void 0}}(t))||r&&t&&"number"==typeof t.length){n&&(t=n);var o=0;return function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function o(t,e,r){if(!t.s){if(r instanceof i){if(!r.s)return void(r.o=o.bind(null,t,e));1&e&&(e=r.s),r=r.v}if(r&&r.then)return void r.then(o.bind(null,t,e),o.bind(null,t,2));t.s=e,t.v=r;var n=t.o;n&&n(t)}}var i=/*#__PURE__*/function(){function t(){}return t.prototype.then=function(e,r){var n=new t,i=this.s;if(i){var u=1&i?e:r;if(u){try{o(n,1,u(this.v))}catch(t){o(n,2,t)}return n}return this}return this.o=function(t){try{var i=t.v;1&t.s?o(n,1,e?e(i):i):r?o(n,1,r(i)):o(n,2,i)}catch(t){o(n,2,t)}},n},t}();function u(t){return t instanceof i&&1&t.s}var a=function t(e,r,a){var l=(void 0===a?{}:a).sort,c=void 0===l?function(){return 1}:l;try{return Promise.resolve(r(e)).then(function(a){if(a){var l=function(t,e,r){if("function"==typeof t[n]){var a,l,c,f=t[n]();if(function t(r){try{for(;!(a=f.next()).done;)if((r=e(a.value))&&r.then){if(!u(r))return void r.then(t,c||(c=o.bind(null,l=new i,2)));r=r.v}l?o(l,1,r):l=r}catch(t){o(l||(l=new i),2,t)}}(),f.return){var h=function(t){try{a.done||f.return()}catch(t){}return t};if(l&&l.then)return l.then(h,function(t){throw h(t)});h()}return l}if(!("length"in t))throw new TypeError("Object is not iterable");for(var s=[],v=0;v<t.length;v++)s.push(t[v]);return function(t,e,r){var n,a,l=-1;return function r(c){try{for(;++l<t.length;)if((c=e(l))&&c.then){if(!u(c))return void c.then(r,a||(a=o.bind(null,n=new i,2)));c=c.v}n?o(n,1,c):n=c}catch(t){o(n||(n=new i),2,t)}}(),n}(s,function(t){return e(s[t])})}(Array.from(e.children).sort(c),function(e){return Promise.resolve(t(e,r,{sort:c})).then(function(){})});return l&&l.then?l.then(function(){}):void 0}})}catch(t){return Promise.reject(t)}},l=function(t){var e=window.getComputedStyle(t).getPropertyValue("z-index");return"auto"===e?0:parseInt(null!=e?e:0)};function c(t,e,r){void 0===e&&(e={});var n="http://www.w3.org/2000/svg",o=document.createElementNS(n,t);for(var i in"svg"===t&&o.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns",n),e)null!=e[i]&&o.setAttribute(i,e[i]);return r&&r.appendChild(o),o}var f=function(t){return function(t,e){var r=e.x,n=e.y,o=e.width,i=e.height,u=e.style;try{if(!o||!i)return Promise.resolve();var a=u.getPropertyValue("background-color");return a&&"none"!==a&&"transparent"!==a?a.startsWith("rgba")&&"0"===a.match(/[\d.]+/g)[3]?Promise.resolve():Promise.resolve(c("rect",{x:r,y:n,width:o,height:i,fill:a,rx:parseInt(u.getPropertyValue("border-radius"))||null})):Promise.resolve()}catch(t){return Promise.reject(t)}}},h=function(t){return function(t,e){var r=e.x,n=e.y,o=e.width,i=e.height;try{return Promise.resolve(c("image",{x:r,y:n,width:o,height:i,href:"data:image/svg+xml;base64,"+btoa((new XMLSerializer).serializeToString(t))}))}catch(t){return Promise.reject(t)}}},s={__proto__:null,div:f,text:function(t){var e=t.debug,n=t.fonts;return function(t,o){var i,u=o.x,a=o.y,l=o.width,f=o.height,h=o.style;try{var s=function(t,r,n){var o=void 0===n?{}:n,i=o.orientation,h=void 0===i?"horizontal":i,s=o.stroke;return e&&c("line",{title:t,"data-value":r,x1:"horizontal"===h?u:u+r,x2:"horizontal"===h?u+l:u+r,y1:"horizontal"===h?a+r:a,y2:"horizontal"===h?a+r:a+f,stroke:void 0===s?"black":s,class:"debug"},v)};if(!t)return Promise.resolve();var v=c("g"),d=n.find((i=h,function(t){var e,r,n,o=void 0===t?{}:t,u=o.style,a=void 0===u?"normal":u,l=o.weight,c=void 0===l?"400":l;return o.family===(null!=(e=i.getPropertyValue("font-family"))?e:"").replace(/['"]/g,"")&&a===(null!=(r=i.getPropertyValue("font-style"))?r:"normal")&&c===(null!=(n=i.getPropertyValue("font-weight"))?n:"400")}));if(!d)throw new Error("Cannot find font '"+h.getPropertyValue("font-family")+" "+h.getPropertyValue("font-style")+" "+h.getPropertyValue("font-weight")+"'");var y=d.opentype.unitsPerEm,g=d.opentype.tables.hhea.ascender,p=d.opentype.tables.hhea.descender,m=h.getPropertyValue("letter-spacing"),w=parseFloat(h.getPropertyValue("font-size")),b=w*((g-p)/y)-Math.abs(p/y)*w;if(s("start",0,{orientation:"vertical",stroke:"red"}),s("end",l,{orientation:"vertical",stroke:"red"}),s("leading",b,{stroke:"#4b96ff"}),"normal"!==m)for(var x,P=r(t);!(x=P()).done;){var S=x.value;c("path",{d:d.opentype.getPath(S,u,a+b,w).toPathData(3),fill:h.getPropertyValue("color")},v),u+=d.opentype.getAdvanceWidth(S,w)+parseFloat(m)}else c("path",{d:d.opentype.getPath(t,u,a+b,w,{features:{liga:!0,rlig:!0}}).toPathData(3),fill:h.getPropertyValue("color")},v);return Promise.resolve(v)}catch(t){return Promise.reject(t)}}},svg:h,DIV:f,CANVAS:function(t){return function(t,e){var r=e.x,n=e.y,o=e.width,i=e.height;try{return Promise.resolve(c("image",{x:r,y:n,width:o,height:i,href:t.toDataURL("image/png")}))}catch(t){return Promise.reject(t)}}},IMG:function(t){return function(t,e){var r=e.x,n=e.y,o=e.width,i=e.height;try{return o&&i&&t.src?Promise.resolve(c("image",{x:r,y:n,width:o,height:i,href:t.src})):Promise.resolve()}catch(t){return Promise.reject(t)}}},SVG:h};const v="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function d(t,e,r){if(!t.s){if(r instanceof y){if(!r.s)return void(r.o=d.bind(null,t,e));1&e&&(e=r.s),r=r.v}if(r&&r.then)return void r.then(d.bind(null,t,e),d.bind(null,t,2));t.s=e,t.v=r;var n=t.o;n&&n(t)}}var y=/*#__PURE__*/function(){function t(){}return t.prototype.then=function(e,r){var n=new t,o=this.s;if(o){var i=1&o?e:r;if(i){try{d(n,1,i(this.v))}catch(t){d(n,2,t)}return n}return this}return this.o=function(t){try{var o=t.v;1&t.s?d(n,1,e?e(o):o):r?d(n,1,r(o)):d(n,2,o)}catch(t){d(n,2,t)}},n},t}();function g(t){return t instanceof y&&1&t.s}function p(t,e,r){if("function"==typeof t[v]){var n,o,i,u=t[v]();if(function t(a){try{for(;!((n=u.next()).done||r&&r());)if((a=e(n.value))&&a.then){if(!g(a))return void a.then(t,i||(i=d.bind(null,o=new y,2)));a=a.v}o?d(o,1,a):o=a}catch(t){d(o||(o=new y),2,t)}}(),u.return){var a=function(t){try{n.done||u.return()}catch(t){}return t};if(o&&o.then)return o.then(a,function(t){throw a(t)});a()}return o}if(!("length"in t))throw new TypeError("Object is not iterable");for(var l=[],c=0;c<t.length;c++)l.push(t[c]);return function(t,e,r){var n,o,i=-1;return function u(a){try{for(;++i<t.length&&(!r||!r());)if((a=e(i))&&a.then){if(!g(a))return void a.then(u,o||(o=d.bind(null,n=new y,2)));a=a.v}n?d(n,1,a):n=a}catch(t){d(n||(n=new y),2,t)}}(),n}(l,function(t){return e(l[t])},r)}function m(e,n){void 0===e&&(e=document.body);var o=void 0===n?{}:n,i=o.debug,u=void 0!==i&&i,f=o.ignore,h=void 0===f?"":f,v=o.fonts,d=void 0===v?[]:v,y={};for(var g in s)y[g]=s[g]({debug:u,fonts:d});return{preload:function(){try{var e=p(d,function(e){if(!e.opentype)return Promise.resolve(new Promise(function(r){t.load(e.url,function(t,e){if(t)throw t;r(e)})})).then(function(t){e.opentype=t})});return Promise.resolve(e&&e.then?e.then(function(){}):void 0)}catch(t){return Promise.reject(t)}},flush:function(){for(var t,e=r(d);!(t=e()).done;)delete t.value.opentype},compute:function(){try{var t=e.getBoundingClientRect(),r=c("svg",{viewBox:"0 0 "+t.width+" "+t.height,width:t.width,height:t.height,preserveAspectRatio:"none"}),n=r;return Promise.resolve(a(e,function(o){try{var i;if(h&&o!==e&&o.matches(h))return Promise.resolve();var u=window.getComputedStyle(o),a=o.getBoundingClientRect(),l=a.x,f=a.y,s=a.width,v=a.height,d=u.getPropertyValue("clip-path");"none"!==d&&(n=c("g",null,r)).setAttribute("style","clip-path: "+d);var g=null!=(i=y[o.tagName])?i:y.div;return Promise.resolve(g(o,{x:l-t.x,y:f-t.y,width:s,height:v,style:u})).then(function(e){e&&n.appendChild(e);var r=function(){if(o.innerText)return p(o.childNodes,function(e){if(e.nodeType===Node.TEXT_NODE&&e.textContent.length){if(!/^\s/.test(e.textContent))return p(function(t,e){void 0===e&&(e=t.innerText||t.textContent);for(var r=document.createRange(),n=[],o=0;o<t.length;o++){var i;r.setStart(t,0),r.setEnd(t,o+1);var u=r.getClientRects(),a=u.length-1;n[a]=null!=(i=n[a])?i:{text:""},n[a].rect=u[a],n[a].text+=e.charAt(o)}return n.map(function(t){return t.fragment=new DocumentFragment,t.fragment.textContent=t.text,t})}(e),function(e){var r=e.rect,o=e.fragment,i=function(e,i){try{var a=Promise.resolve(y.text(o.textContent.trimEnd(),{x:r.x-t.x,y:r.y-t.y,width:r.width,height:r.height,style:u})).then(function(t){t&&n.appendChild(t)})}catch(t){return i(t)}return a&&a.then?a.then(void 0,i):a}(0,function(t){console.warn(new Error("Rendering failed for the following text: '"+o.textContent+"'",{cause:t})),console.warn(t)});if(i&&i.then)return i.then(function(){})});e.splitText(1)}})}();return!r||!r.then||r.then(function(){return!0})})}catch(t){return Promise.reject(t)}},{sort:function(t,e){var r,n;return t.zIndex=null!=(r=t.zIndex)?r:l(t),e.zIndex=null!=(n=e.zIndex)?n:l(e),t.zIndex-e.zIndex}})).then(function(){return r})}catch(t){return Promise.reject(t)}}}}export{m as default};
//# sourceMappingURL=html-to-svg.module.js.map
