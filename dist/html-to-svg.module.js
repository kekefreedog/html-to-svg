import t from"opentype.js";function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function n(t,n){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(r)return(r=r.call(t)).next.bind(r);if(Array.isArray(t)||(r=function(t,n){if(t){if("string"==typeof t)return e(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?e(t,n):void 0}}(t))||n&&t&&"number"==typeof t.length){r&&(t=r);var o=0;return function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function o(t,e,n){if(!t.s){if(n instanceof i){if(!n.s)return void(n.o=o.bind(null,t,e));1&e&&(e=n.s),n=n.v}if(n&&n.then)return void n.then(o.bind(null,t,e),o.bind(null,t,2));t.s=e,t.v=n;var r=t.o;r&&r(t)}}var i=/*#__PURE__*/function(){function t(){}return t.prototype.then=function(e,n){var r=new t,i=this.s;if(i){var u=1&i?e:n;if(u){try{o(r,1,u(this.v))}catch(t){o(r,2,t)}return r}return this}return this.o=function(t){try{var i=t.v;1&t.s?o(r,1,e?e(i):i):n?o(r,1,n(i)):o(r,2,i)}catch(t){o(r,2,t)}},r},t}();function u(t){return t instanceof i&&1&t.s}var a=function t(e,n,a){var f=(void 0===a?{}:a).sort,c=void 0===f?function(){return 1}:f;try{return Promise.resolve(n(e)).then(function(a){if(a){var f=function(t,e,n){if("function"==typeof t[r]){var a,f,c,l=t[r]();if(function t(n){try{for(;!(a=l.next()).done;)if((n=e(a.value))&&n.then){if(!u(n))return void n.then(t,c||(c=o.bind(null,f=new i,2)));n=n.v}f?o(f,1,n):f=n}catch(t){o(f||(f=new i),2,t)}}(),l.return){var h=function(t){try{a.done||l.return()}catch(t){}return t};if(f&&f.then)return f.then(h,function(t){throw h(t)});h()}return f}if(!("length"in t))throw new TypeError("Object is not iterable");for(var s=[],v=0;v<t.length;v++)s.push(t[v]);return function(t,e,n){var r,a,f=-1;return function n(c){try{for(;++f<t.length;)if((c=e(f))&&c.then){if(!u(c))return void c.then(n,a||(a=o.bind(null,r=new i,2)));c=c.v}r?o(r,1,c):r=c}catch(t){o(r||(r=new i),2,t)}}(),r}(s,function(t){return e(s[t])})}(Array.from(e.children).sort(c),function(e){return Promise.resolve(t(e,n,{sort:c})).then(function(){})});return f&&f.then?f.then(function(){}):void 0}})}catch(t){return Promise.reject(t)}},f=function(t){var e=window.getComputedStyle(t).getPropertyValue("z-index");return"auto"===e?0:parseInt(null!=e?e:0)};function c(t,e,n){void 0===e&&(e={});var r="http://www.w3.org/2000/svg",o=document.createElementNS(r,t);for(var i in"svg"===t&&o.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns",r),e)null!=e[i]&&o.setAttribute(i,e[i]);return n&&n.appendChild(o),o}var l=function(t){return function(t,e){var n=e.x,r=e.y,o=e.width,i=e.height,u=e.style;try{if(!o||!i)return Promise.resolve();var a=u.getPropertyValue("background-color");return a&&"none"!==a&&"transparent"!==a?a.startsWith("rgba")&&"0"===a.match(/[\d.]+/g)[3]?Promise.resolve():Promise.resolve(c("rect",{x:n,y:r,width:o,height:i,fill:a,rx:parseInt(u.getPropertyValue("border-radius"))||null})):Promise.resolve()}catch(t){return Promise.reject(t)}}};const h="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function s(t,e,n){if(!t.s){if(n instanceof v){if(!n.s)return void(n.o=s.bind(null,t,e));1&e&&(e=n.s),n=n.v}if(n&&n.then)return void n.then(s.bind(null,t,e),s.bind(null,t,2));t.s=e,t.v=n;var r=t.o;r&&r(t)}}var v=/*#__PURE__*/function(){function t(){}return t.prototype.then=function(e,n){var r=new t,o=this.s;if(o){var i=1&o?e:n;if(i){try{s(r,1,i(this.v))}catch(t){s(r,2,t)}return r}return this}return this.o=function(t){try{var o=t.v;1&t.s?s(r,1,e?e(o):o):n?s(r,1,n(o)):s(r,2,o)}catch(t){s(r,2,t)}},r},t}();function d(t){return t instanceof v&&1&t.s}var y=function(t){var e=t.cache;return function(t,n,r){var o=n.x,i=n.y,u=n.width,a=n.height,f=(void 0===r?{}:r).rasterizeNestedSVG,l=void 0===f||f;try{var y=function(){return l?c("image",{x:o,y:i,width:u,height:a,href:"data:image/svg+xml;base64,"+btoa((new XMLSerializer).serializeToString(t))}):function(){var e=c("svg",{x:o,y:i,width:u,height:a,viewbox:"0 0 "+u+" "+a});return e.innerHTML=t.outerHTML,e}()},g=function(t,e,n){if("function"==typeof t[h]){var r,o,i,u=t[h]();if(function t(n){try{for(;!(r=u.next()).done;)if((n=e(r.value))&&n.then){if(!d(n))return void n.then(t,i||(i=s.bind(null,o=new v,2)));n=n.v}o?s(o,1,n):o=n}catch(t){s(o||(o=new v),2,t)}}(),u.return){var a=function(t){try{r.done||u.return()}catch(t){}return t};if(o&&o.then)return o.then(a,function(t){throw a(t)});a()}return o}if(!("length"in t))throw new TypeError("Object is not iterable");for(var f=[],c=0;c<t.length;c++)f.push(t[c]);return function(t,e,n){var r,o,i=-1;return function n(u){try{for(;++i<t.length;)if((u=e(i))&&u.then){if(!d(u))return void u.then(n,o||(o=s.bind(null,r=new v,2)));u=u.v}r?s(r,1,u):r=u}catch(t){s(r||(r=new v),2,t)}}(),r}(f,function(t){return e(f[t])})}(t.querySelectorAll("image[href]"),function(t){function n(){t.setAttribute("href",e.get(r))}var r=t.getAttribute("href"),o=function(){if(!e.has(r))return Promise.resolve(new Promise(function(t){var e=new XMLHttpRequest;e.open("GET",r,!0),e.responseType="blob",e.onload=function(){return t(e.response)},e.send()})).then(function(t){return Promise.resolve(new Promise(function(e){var n=new FileReader;n.onload=function(t){return e(t.target.result)},n.readAsDataURL(t)})).then(function(t){e.set(r,t)})})}();return o&&o.then?o.then(n):n()});return Promise.resolve(g&&g.then?g.then(y):y())}catch(t){return Promise.reject(t)}}},g={__proto__:null,div:l,text:function(t){var e=t.debug,r=t.fonts;return function(t,o){var i,u=o.x,a=o.y,f=o.width,l=o.height,h=o.style;try{var s=function(t,n,r){var o=void 0===r?{}:r,i=o.orientation,h=void 0===i?"horizontal":i,s=o.stroke;return e&&c("line",{title:t,"data-value":n,x1:"horizontal"===h?u:u+n,x2:"horizontal"===h?u+f:u+n,y1:"horizontal"===h?a+n:a,y2:"horizontal"===h?a+n:a+l,stroke:void 0===s?"black":s,class:"debug"},v)};if(!t)return Promise.resolve();var v=c("g"),d=r.find((i=h,function(t){var e,n,r,o=void 0===t?{}:t,u=o.style,a=void 0===u?"normal":u,f=o.weight,c=void 0===f?"400":f;return o.family===(null!=(e=i.getPropertyValue("font-family"))?e:"").replace(/['"]/g,"")&&a===(null!=(n=i.getPropertyValue("font-style"))?n:"normal")&&c===(null!=(r=i.getPropertyValue("font-weight"))?r:"400")}));if(!d)throw new Error("Cannot find font '"+h.getPropertyValue("font-family")+" "+h.getPropertyValue("font-style")+" "+h.getPropertyValue("font-weight")+"'");var y=d.opentype.unitsPerEm,g=d.opentype.tables.hhea.ascender,p=d.opentype.tables.hhea.descender,m=h.getPropertyValue("letter-spacing"),w=parseFloat(h.getPropertyValue("font-size")),b=w*((g-p)/y)-Math.abs(p/y)*w;if(s("start",0,{orientation:"vertical",stroke:"red"}),s("end",f,{orientation:"vertical",stroke:"red"}),s("leading",b,{stroke:"#4b96ff"}),"normal"!==m)for(var x,P=n(t);!(x=P()).done;){var S=x.value;c("path",{d:d.opentype.getPath(S,u,a+b,w).toPathData(3),fill:h.getPropertyValue("color")},v),u+=d.opentype.getAdvanceWidth(S,w)+parseFloat(m)}else c("path",{d:d.opentype.getPath(t,u,a+b,w,{features:{liga:!0,rlig:!0}}).toPathData(3),fill:h.getPropertyValue("color")},v);return Promise.resolve(v)}catch(t){return Promise.reject(t)}}},svg:y,DIV:l,CANVAS:function(t){return function(t,e){var n=e.x,r=e.y,o=e.width,i=e.height;try{return Promise.resolve(c("image",{x:n,y:r,width:o,height:i,href:t.toDataURL("image/png")}))}catch(t){return Promise.reject(t)}}},IMG:function(t){return function(t,e){var n=e.x,r=e.y,o=e.width,i=e.height;try{return o&&i&&t.src?Promise.resolve(c("image",{x:n,y:r,width:o,height:i,href:t.src})):Promise.resolve()}catch(t){return Promise.reject(t)}}},SVG:y};const p="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function m(t,e,n){if(!t.s){if(n instanceof w){if(!n.s)return void(n.o=m.bind(null,t,e));1&e&&(e=n.s),n=n.v}if(n&&n.then)return void n.then(m.bind(null,t,e),m.bind(null,t,2));t.s=e,t.v=n;var r=t.o;r&&r(t)}}var w=/*#__PURE__*/function(){function t(){}return t.prototype.then=function(e,n){var r=new t,o=this.s;if(o){var i=1&o?e:n;if(i){try{m(r,1,i(this.v))}catch(t){m(r,2,t)}return r}return this}return this.o=function(t){try{var o=t.v;1&t.s?m(r,1,e?e(o):o):n?m(r,1,n(o)):m(r,2,o)}catch(t){m(r,2,t)}},r},t}();function b(t){return t instanceof w&&1&t.s}function x(t,e,n){if("function"==typeof t[p]){var r,o,i,u=t[p]();if(function t(a){try{for(;!((r=u.next()).done||n&&n());)if((a=e(r.value))&&a.then){if(!b(a))return void a.then(t,i||(i=m.bind(null,o=new w,2)));a=a.v}o?m(o,1,a):o=a}catch(t){m(o||(o=new w),2,t)}}(),u.return){var a=function(t){try{r.done||u.return()}catch(t){}return t};if(o&&o.then)return o.then(a,function(t){throw a(t)});a()}return o}if(!("length"in t))throw new TypeError("Object is not iterable");for(var f=[],c=0;c<t.length;c++)f.push(t[c]);return function(t,e,n){var r,o,i=-1;return function u(a){try{for(;++i<t.length&&(!n||!n());)if((a=e(i))&&a.then){if(!b(a))return void a.then(u,o||(o=m.bind(null,r=new w,2)));a=a.v}r?m(r,1,a):r=a}catch(t){m(r||(r=new w),2,t)}}(),r}(f,function(t){return e(f[t])},n)}function P(e){var r=void 0===e?{}:e,o=r.debug,i=void 0!==o&&o,u=r.ignore,l=void 0===u?"":u,h=r.fonts,s=void 0===h?[]:h,v=new Map,d={};for(var y in g)d[y]=g[y]({debug:i,fonts:s,cache:v});return{get cache(){return v},preload:function(){try{var e=x(s,function(e){if(!e.opentype)return Promise.resolve(new Promise(function(n){t.load(e.url,function(t,e){if(t)throw t;n(e)})})).then(function(t){e.opentype=t})});return Promise.resolve(e&&e.then?e.then(function(){}):void 0)}catch(t){return Promise.reject(t)}},destroy:function(){v.clear();for(var t,e=n(s);!(t=e()).done;)delete t.value.opentype},render:function(t,e){void 0===e&&(e={});try{var n=t.getBoundingClientRect(),r=c("svg",{viewBox:"0 0 "+n.width+" "+n.height,width:n.width,height:n.height,preserveAspectRatio:"none"}),o=r;return Promise.resolve(a(t,function(i){try{var u;if(l&&i!==t&&i.matches(l))return Promise.resolve();var a=window.getComputedStyle(i),f=i.getBoundingClientRect(),h=f.x,s=f.y,v=f.width,y=f.height,g=a.getPropertyValue("clip-path");"none"!==g&&(o=c("g",null,r)).setAttribute("style","clip-path: "+g);var p=null!=(u=d[i.tagName])?u:d.div;return Promise.resolve(p(i,{x:h-n.x,y:s-n.y,width:v,height:y,style:a},e)).then(function(t){t&&o.appendChild(t);var r=function(){if(i.innerText)return x(i.childNodes,function(t){if(t.nodeType===Node.TEXT_NODE&&t.textContent.length){if(!/^\s/.test(t.textContent))return x(function(t,e){void 0===e&&(e=t.innerText||t.textContent);for(var n=document.createRange(),r=[],o=0;o<t.length;o++){var i;n.setStart(t,0),n.setEnd(t,o+1);var u=n.getClientRects(),a=u.length-1;r[a]=null!=(i=r[a])?i:{text:""},r[a].rect=u[a],r[a].text+=e.charAt(o)}return r.map(function(t){return t.fragment=new DocumentFragment,t.fragment.textContent=t.text,t})}(t),function(t){var r=t.rect,i=t.fragment,u=function(t,u){try{var f=Promise.resolve(d.text(i.textContent.trimEnd(),{x:r.x-n.x,y:r.y-n.y,width:r.width,height:r.height,style:a},e)).then(function(t){t&&o.appendChild(t)})}catch(t){return u(t)}return f&&f.then?f.then(void 0,u):f}(0,function(t){console.warn(new Error("Rendering failed for the following text: '"+i.textContent+"'",{cause:t})),console.warn(t)});if(u&&u.then)return u.then(function(){})});t.splitText(1)}})}();return!r||!r.then||r.then(function(){return!0})})}catch(t){return Promise.reject(t)}},{sort:function(t,e){var n,r;return t.zIndex=null!=(n=t.zIndex)?n:f(t),e.zIndex=null!=(r=e.zIndex)?r:f(e),t.zIndex-e.zIndex}})).then(function(){return r})}catch(t){return Promise.reject(t)}}}}export{P as default};
//# sourceMappingURL=html-to-svg.module.js.map
