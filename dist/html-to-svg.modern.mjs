import t from"opentype.js";async function e(t,n){if(await n(t))for(const r of t.children)await e(r,n)}function n(t,e=t.innerText||t.textContent){const n=document.createRange(),r=[];for(let a=0;a<t.length;a++){var o;n.setStart(t,0),n.setEnd(t,a+1);const i=n.getClientRects(),l=i.length-1;r[l]=null!=(o=r[l])?o:{text:""},r[l].rect=i[l],r[l].text+=e.charAt(a)}return r.map(t=>(t.fragment=new DocumentFragment,t.fragment.textContent=t.text,t))}function r(t,e={},n){const r="http://www.w3.org/2000/svg",o=document.createElementNS(r,t);"svg"===t&&o.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns",r);for(const t in e)null!=e[t]&&o.setAttribute(t,e[t]);return n&&n.appendChild(o),o}var o=({})=>async(t,{x:e,y:n,width:o,height:a,style:i})=>{if(!o||!a)return;const l=i.getPropertyValue("background-color");if(l&&"none"!==l&&"transparent"!==l){if(l.startsWith("rgba")&&"0"===l.match(/[\d.]+/g)[3])return;return r("rect",{x:e,y:n,width:o,height:a,fill:l,rx:parseInt(i.getPropertyValue("border-radius"))||null})}},a=({})=>async(t,{x:e,y:n,width:o,height:a})=>r("image",{x:e,y:n,width:o,height:a,href:"data:image/svg+xml;base64,"+btoa((new XMLSerializer).serializeToString(t))}),i={__proto__:null,div:o,text:({debug:t,fonts:e})=>async(n,{x:o,y:a,width:i,height:l,style:s})=>{if(!n)return;const h=r("g"),g=e.find((c=s,({family:t,style:e="normal",weight:n="400"}={})=>{var r,o,a;return t===(null!=(r=c.getPropertyValue("font-family"))?r:"").replace(/['"]/g,"")&&e===(null!=(o=c.getPropertyValue("font-style"))?o:"normal")&&n===(null!=(a=c.getPropertyValue("font-weight"))?a:"400")}));var c;if(!g)throw new Error(`Cannot find font '${s.getPropertyValue("font-family")} ${s.getPropertyValue("font-style")} ${s.getPropertyValue("font-weight")}'`);const{unitsPerEm:f}=g.opentype,d=g.opentype.tables.hhea.ascender,u=g.opentype.tables.hhea.descender,y=s.getPropertyValue("letter-spacing"),p=parseFloat(s.getPropertyValue("font-size")),w=p*((d-u)/f)-Math.abs(u/f)*p;if(x("start",0,{orientation:"vertical",stroke:"red"}),x("end",i,{orientation:"vertical",stroke:"red"}),x("leading",w,{stroke:"#4b96ff"}),"normal"!==y)for(const t of n)r("path",{d:g.opentype.getPath(t,o,a+w,p).toPathData(3),fill:s.getPropertyValue("color")},h),o+=g.opentype.getAdvanceWidth(t,p)+parseFloat(y);else r("path",{d:g.opentype.getPath(n,o,a+w,p,{features:{liga:!0,rlig:!0}}).toPathData(3),fill:s.getPropertyValue("color")},h);return h;function x(e,n,{orientation:s="horizontal",stroke:g="black"}={}){return t&&r("line",{title:e,"data-value":n,x1:"horizontal"===s?o:o+n,x2:"horizontal"===s?o+i:o+n,y1:"horizontal"===s?a+n:a,y2:"horizontal"===s?a+n:a+l,stroke:g,class:"debug"},h)}},svg:a,DIV:o,CANVAS:({})=>async(t,{x:e,y:n,width:o,height:a})=>r("image",{x:e,y:n,width:o,height:a,href:t.toDataURL("image/png")}),IMG:({})=>async(t,{x:e,y:n,width:o,height:a})=>{if(o&&a&&t.src)return r("image",{x:e,y:n,width:o,height:a,href:t.src})},SVG:a};function l(o=document.body,{debug:a=!1,ignore:l="",fonts:s=[]}={}){const h={};for(const t in i)h[t]=i[t]({debug:a,fonts:s});return{preload:async function(){for(const e of s)e.opentype||(e.opentype=await new Promise(n=>{t.load(e.url,(t,e)=>{if(t)throw t;n(e)})}))},flush:function(){for(const t of s)delete t.opentype},compute:async function(){const t=o.getBoundingClientRect(),a=r("svg",{viewBox:`0 0 ${t.width} ${t.height}`,width:t.width,height:t.height,preserveAspectRatio:"none"});return await e(o,async e=>{var r;if(l&&e!==o&&e.matches(l))return;const i=window.getComputedStyle(e),{x:s,y:g,width:c,height:f}=e.getBoundingClientRect(),d=null!=(r=h[e.tagName])?r:h.div,u=await d(e,{x:s-t.x,y:g-t.y,width:c,height:f,style:i});if(u&&a.appendChild(u),e.innerText)for(const r of e.childNodes)if(r.nodeType===Node.TEXT_NODE&&r.textContent.length)if(/^\s/.test(r.textContent))r.splitText(1);else for(const{rect:e,fragment:o}of n(r))try{const n=await h.text(o.textContent.trimEnd(),{x:e.x-t.x,y:e.y-t.y,width:e.width,height:e.height,style:i});n&&a.appendChild(n)}catch(t){console.warn(new Error(`Rendering failed for the following text: '${o.textContent}'`,{cause:t})),console.warn(t)}return!0}),a}}}export{l as default};
//# sourceMappingURL=html-to-svg.modern.mjs.map
